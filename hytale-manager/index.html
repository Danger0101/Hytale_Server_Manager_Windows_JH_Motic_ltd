<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hytale Server Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <div id="sidebar">
            <h1>Servers</h1>
            <ul id="serverList"></ul>
            <button id="addServerBtn">Add Server</button>
        </div>
        <div id="mainContent">
            <div id="welcomeView" style="display: none;">
                <h2>Welcome to Hytale Server Manager!</h2>
                <p>Add your first server to get started.</p>
                <button id="initialAddServerBtn">Add Server</button>
            </div>
            <div id="serverView" style="display: none;">
                <h2 id="serverNameTitle"></h2>
                <div class="server-controls">
                    <button id="startButton">Start</button>
                    <button id="stopButton">Stop</button>
                    <input type="text" id="commandInput" placeholder="Enter command">
                    <button id="sendCommandBtn">Send Command</button>
                    <button id="quickDownloadBtn">Quick Download</button>
                </div>
                <div id="jarStatusArea" style="display: none; color: orange; margin-top: 10px;">
                    Warning: JAR file not found. Use Hytale Downloader CLI to install.
                </div>
                <div id="console" style="background-color: black; color: white; height: 300px; overflow-y: scroll; margin-top: 10px; padding: 10px;"></div>
            </div>
        </div>
    </div>

    <!-- Server Modal -->
    <div id="serverModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="modalTitle">Add New Server</h2>
            <div class="modal-tabs">
                <button class="modal-tab-btn active" data-tab="tab-general">General</button>
                <button class="modal-tab-btn" data-tab="tab-advanced">Advanced</button>
                <button class="modal-tab-btn" data-tab="tab-hytale-cloud">Hytale Cloud</button>
            </div>
            <form id="serverForm">
                <input type="hidden" id="serverId">
                <div id="tab-general" class="tab-content active">
                    <label for="serverNameInput">Server Name:</label>
                    <input type="text" id="serverNameInput" required>
                    <label for="serverPathInput">Server Path:</label>
                    <input type="text" id="serverPathInput" readonly required>
                    <button type="button" id="browseBtn">Browse</button>
                    <label for="jarFileInput">Server JAR File:</label>
                    <input type="text" id="jarFileInput" placeholder="e.g., hytale-server.jar" required>
                    <button type="button" id="jarBrowseBtn">Browse</button>
                </div>
                <div id="tab-advanced" class="tab-content">
                    <label for="javaArgsInput">Java Arguments:</label>
                    <input type="text" id="javaArgsInput" placeholder="-Xmx4G -Xms2G">
                    <label for="javaPathInput">Java Executable Path (Optional):</label>
                    <input type="text" id="javaPathInput" placeholder="C:\Program Files\Java\jdk-21\bin\java.exe">
                    <button type="button" id="checkJavaBtn">Check Java</button>
                    <label for="discordWebhookInput">Discord Webhook URL:</label>
                    <input type="text" id="discordWebhookInput">
                    <label for="updateUrlInput">Update URL (Optional):</label>
                    <input type="text" id="updateUrlInput">
                    <label>
                        <input type="checkbox" id="autoUpdateCheckbox"> Auto Update
                    </label>
                </div>
                <div id="tab-hytale-cloud" class="tab-content">
                    <label for="hytaleApiKeyInput">Hytale API Key (Optional):</label>
                    <input type="text" id="hytaleApiKeyInput">
                    <label>
                        <input type="checkbox" id="enablePaymentsCheckbox"> Enable Payments Integration
                    </label>
                    <div id="paymentSettings" style="display: none;">
                        <label for="merchantIdInput">Merchant ID:</label>
                        <input type="text" id="merchantIdInput">
                    </div>
                    <label for="authSessionTokenInput">Auth Session Token:</label>
                    <input type="text" id="authSessionTokenInput" readonly>
                    <label for="authIdentityTokenInput">Auth Identity Token:</label>
                    <input type="text" id="authIdentityTokenInput" readonly>
                    <button type="button" id="installCliBtn">‚òÅÔ∏è Hytale Downloader CLI</button>
                </div>
                <button type="submit">Save Server</button>
            </form>
        </div>
    </div>

    <!-- Authentication Modal (from user's previous input) -->
    <div id="deviceAuthModal" class="modal" style="display: none; z-index: 2000;">
        <div class="modal-content" style="max-width: 400px; text-align: center; border: 1px solid #6f42c1;">
            <h2 style="color: #6f42c1;">üîê Authentication Required</h2>
            <p style="color: #ccc;">The Hytale Tool needs your permission.</p>
            
            <div style="background: #111; padding: 15px; border-radius: 4px; margin: 15px 0;">
                <div style="font-size: 0.8em; color: #888; margin-bottom: 5px;">USER CODE</div>
                <div id="deviceAuthCode" style="font-size: 2em; font-weight: bold; letter-spacing: 3px; color: #fff; cursor: pointer;" title="Click to Copy">
                    ----
                </div>
            </div>

            <p>1. Copy the code above.<br>2. Click the button below to open the login page.<br>3. Paste the code.</p>

            <a id="deviceAuthLink" href="#" target="_blank" style="display: inline-block; background: #6f42c1; color: white; text-decoration: none; padding: 10px 20px; border-radius: 4px; font-weight: bold; margin-bottom: 10px;">
                Open Login Page ‚Üó
            </a>
            
            <button id="closeAuthModal" style="background: transparent; border: 1px solid #444; color: #888; padding: 5px 10px; margin-top: 10px; cursor: pointer;">
                Close / I have finished
            </button>
        </div>
    </div>

    <script src="renderer.js"></script>
</body>
</html>